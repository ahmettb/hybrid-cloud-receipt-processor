# AI-Powered Receipt Processing System 

This project is a hybrid cloud system that automatically reads market receipts and stores structured data securely.  
AWS is used for serverless AI processing and API management, while Oracle Cloud (OCI) is used for high-performance and secure data persistence.

---

## System Architecture 

The system is designed with **maximum network isolation**.  
All sensitive processing stays inside private networks, and outbound traffic is strictly controlled through a single point.

### Architecture Diagram

![Security-First Hybrid Cloud Architecture](https://i.hizliresim.com/ex54f2a.png)

**Diagram Explanation:**

- **Custom AWS VPC (172.0.0.0/16):** A dedicated virtual private cloud provides an isolated network environment, ensuring that the project resources are not part of the default shared network.

- **Private Subnet (172.0.1.0/24):** All processing logic and Lambda functions are located here. This subnet has no direct access to the internet, which protects the core application from external threats.

- **Public Subnet (172.0.2.0/24):** This layer acts as a managed entry and exit point. It hosts the components that need to communicate with the outside world, such as the API Gateway and the NAT Instance.

- **NAT Instance & Static IP (3.239.6.232):** Since the Lambdas are in a private subnet, they use this NAT Instance to send data to the Oracle Database. The static Elastic IP allows for a consistent identity when communicating outside of AWS.

- **AWS API Gateway:** This serves as the secure front door for the application. It receives external requests for data retrieval and forwards them to the internal functions.

- **Oracle Autonomous Database (OCI) Connectivity:** To ensure maximum security, the Oracle Database is configured to reject all traffic except for requests coming from the specific static IP of the AWS NAT Instance.

---

## Network and Security Details

The architecture follows a strict *deny-by-default* model.

### Network Segmentation (IP Plan)

| Component | Location | CIDR / IP | Purpose |
| :--- | :--- | :--- | :--- |
| VPC | AWS | 172.0.0.0/16 | Main isolated network |
| Private Subnet | AWS | 172.0.1.0/24 | Lambda, VPC Endpoints |
| Public Subnet | AWS | 172.0.2.0/24 | NAT Instance, API Gateway Path |
| NAT Instance | AWS | 3.239.6.232 | Single authorized egress |
| Oracle DB | OCI | Private Endpoint | Data persistence |

No compute resource has direct internet access.

---

## End-to-End Data Flow

1. **Receipt Upload:** The user uploads a receipt image to Amazon S3.
2. **Event-Driven Processing:** An S3 event triggers an AWS Lambda function inside the Private Subnet.
3. **Private AI & OCR:** - Amazon Textract extracts text.
   - Amazon Bedrock (Claude 3 Haiku) transforms OCR output into structured JSON.
   - All access happens through **VPC Interface Endpoints (PrivateLink)**.
4. **Controlled Egress:** When data must be saved to Oracle Cloud, traffic is routed through the **NAT Instance**.
5. **Data Retrieval (API):** Authorized users or applications can fetch the processed receipt data through **AWS API Gateway**. This triggers a retrieval Lambda that securely queries the Oracle Database.
6. **Oracle Cloud Access:** Oracle Autonomous Database only accepts connections from **3.239.6.232 (whitelisted static IP)**.

7. **Monitoring & Logging:** Every step of the execution, from S3 triggers to Database connection attempts, is logged via Amazon CloudWatch. Custom metrics and alarms are set up to notify in case of Lambda failures or timeout issues.
---

## Technical Stack

- **API Layer:** AWS API Gateway
- **Compute:** AWS Lambda (Python 3.12)
- **OCR:** Amazon Textract
- **AI Processing:** Amazon Bedrock (Claude 3 Haiku)
- **Storage:** Amazon S3 (private access via Gateway Endpoint)
- **Database:** Oracle Autonomous Database (OCI, mTLS 
Wallet)
- **Monitoring:** Amazon CloudWatch (Logs, Metrics, and Alarms)
---

## Database Schema (Oracle SQL)

```sql
CREATE TABLE market_fisleri (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    magaza_adi VARCHAR2(255),
    fis_tarihi DATE,
    fis_saati VARCHAR2(10),
    toplam_tutar NUMBER(10, 2),
    kdv_tutari NUMBER(10, 2),
    odeme_tipi VARCHAR2(50),
    urun_listesi CLOB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```


## Developer Notes
- A NAT Instance (t2.micro) is used instead of a Managed NAT Gateway to reduce monthly costs.

- The system uses Security Groups and NACLs to control all traffic.

- No backend resource is open to the public internet.

- The design follows the principles of Least-Privilege and Zero-Trust.

- API Gateway acts as the only secure bridge for inbound data requests.
- Observability: All Lambda functions follow a structured logging format sent to CloudWatch Logs, allowing for real-time debugging and performance monitoring of the AI extraction pipeline.
